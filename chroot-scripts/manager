#!/bin/bash

SCRIPTS=(gettext 
		bison 
		perl 
		python 
		texinfo 
		util-linux 
		man-pages 
		iana-etc 
		glibc 
		zlib 
		bzip2 
		xz 
		lz4 
		zstd 
		file 
		readline 
		m4 
		bc 
		flex 
		tcl 
		expect 
		dejagnu 
		pkgconf 
		binutils 
		gmp 
		mpfr 
		mpc 
		attr 
		acl 
		libcap 
		libxcrypt 
		gcc 
		ncurses 
		sed 
		psmisc 
		gettext-pass2 
		bison 
		grep 
		bash 
		libtool 
		gdbm 
		gperf 
		expat 
		inetutils 
		less 
		perl-pass2 
		xml-parser 
		intltool 
		autoconf 
		automake 
		openssl 
		elfutils 
		libffi 
		python-pass2 
		flit-core 
		packaging 
		wheel 
		setuptools 
		ninja 
		meson 
		linux-pam 
		shadow 
		kmod 
		coreutils 
		diffutils 
		gawk 
		findutils 
		groff 
		grub 
		gzip 
		iproute2 
		kbd 
		libpipeline 
		make 
		patch 
		tar 
		texinfo-pass2 
		vim 
		markup 
		jinja2 
		systemd 
		dbus 
		mandb 
		procps-ng 
		util-linux-pass2 
		e2fsprogs 
		)
STEPS=(lfs-copy ${SCRIPTS[@]} lfs-cleanup lfs-setup-font lfs-setup-profile lfs-create-fstab)
set -e
set -u

. /chroot-scripts/setup-script-environment
pushd /sources
for step in ${STEPS[@]}; do
	(
		. /chroot-scripts/$step
		if [ ! -z ${step##lfs-*} ]; then
			package=${PACKAGE:-${step%-pass2}}
			parse_link $download_url
			decompressed_archive=$(get_decompressed_archive $package_archive)
			pushd $decompressed_archive
			do_build
		fi
	)
done
